<!DOCTYPE html>
<html>

  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>GeoTemCo</title>

 	<script src="lib/jquery/jquery.min.js"></script>
 	<script src="lib/jquery/purl.min.js"></script>
 	<script src="lib/jqPlot/jquery.jqplot.js"></script>
 	<link rel="stylesheet" href="lib/jqPlot/jquery.jqplot.min.css" type="text/css" />
 	<style type="text/css">
		table.jqplot-table-legend {
			display: block;
			height: 250px;
			overflow-y: scroll;
		}
	</style>
 	<script src="lib/jqPlot/plugins/jqplot.pieRenderer.js"></script>

 	<script src="js/Util/Publisher.js"></script>
 	<script src="js/Build/Loader/DynaJsLoader.js"></script>
	<script src="js/Build/Loader/Loader.js"></script>
  </head>

  <body>

    <noscript>
      <div style="width: 22em; position: absolute; left: 50%; margin-left: -11em; color: red; background-color: white; border: 1px solid red; padding: 4px; font-family: sans-serif">
        Your web browser must have JavaScript enabled in order for this application to display correctly.
      </div>
    </noscript>

	<fieldset id="dataloaderContainerDiv" style="position:relative;">
		<legend>Load Data</legend>
	</fieldset>
	<fieldset id="overlayloaderContainerDiv" style="position:relative;">
		<legend>Load Overlay</legend>
	</fieldset>
	<table width=100%>
		<tr>
			<td width=50%>
			    <div id="mapContainerDiv" style="position:relative;"></div>
			</td>
			<td width=50%>
				<div id="piechartContainerDiv" style="position:relative;"></div>
			</td>
		</tr>
	</table>
    <div id="plotContainerDiv" style="position:relative;"></div>
    <div id="tableContainerDiv" style="position:relative;"></div>

    <script>
	Publisher.Subscribe( 'GeoTemCoReady', this, function(){
		var datasets = [];
		var mapDiv = document.getElementById("mapContainerDiv");
		var map = new WidgetWrapper();
		var mapWidget = new MapWidget(map,mapDiv,{
			mapTitle: "Publication Place"
		});
		var timeDiv = document.getElementById("plotContainerDiv");
		var time = new WidgetWrapper();
		var timeWidget = new TimeWidget(time,timeDiv,{
			timeTitle: "Publication Date"
		});
		var tableDiv = document.getElementById("tableContainerDiv");
		var table = new WidgetWrapper();
		var tableWidget = new TableWidget(table,tableDiv);
		
		var dataloaderDiv = document.getElementById("dataloaderContainerDiv");
		var dataloader = new WidgetWrapper();
		var dataloaderWidget = new DataloaderWidget(dataloader,dataloaderDiv);

		var overlayloaderDiv = document.getElementById("overlayloaderContainerDiv");
		var overlayloader = new WidgetWrapper();
		var overlayloaderWidget = new OverlayloaderWidget(overlayloader,overlayloaderDiv);
		overlayloaderWidget.attachMapWidget(mapWidget);
		
		var piechartDiv = document.getElementById("piechartContainerDiv");
		var piechart = new WidgetWrapper();
		var piechartWidget = new PieChartWidget(piechart,piechartDiv);
		piechartWidget.addPieChart(0,"objekt");
		piechartWidget.addPieChart(0,"cu_perc",function(data){
			var value = "Wenig CU";
			if (data >= 50.0)
				value = "Viel CU";
			
			return value;
		});
		/*
		var kml1 = GeoTemConfig.getKml('data/heine.kml');
		datasets.push(new Dataset(GeoTemConfig.loadKml(kml1),'Heinrich Heine'));
		var kml2 = GeoTemConfig.getKml('data/kafka.kml');
		datasets.push(new Dataset(GeoTemConfig.loadKml(kml2),'Franz Kafka'));
		var kml3 = GeoTemConfig.getKml('data/goethe.kml');
		datasets.push(new Dataset(GeoTemConfig.loadKml(kml3),'Johann Wolfgang von Goethe'));
		*/
		var csv = GeoTemConfig.getCsv('data/SilberObjekte.csv', function(kmlDom){
			datasets.push(new Dataset(GeoTemConfig.loadKml(kmlDom),'Silber Objekte'));
			
			map.display(datasets);
			time.display(datasets);
			table.display(datasets);
			piechart.display(datasets);
		});

		dataloaderWidget.loadFromURL();
	});
    </script>

  </body>

</html>
